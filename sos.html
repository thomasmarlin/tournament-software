<!DOCTYPE html>
<html>
<script src="jquery-2.1.4.min.js"></script>
<script src="angular.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="ui-bootstrap-tpls-0.14.3.min.js.css"></script>
<script src="sos.js"></script>
<script src="AddPlayerController.js"></script>
<script src="CreateGameController.js"></script>
<script src="CreateEventController.js"></script>
<script src="LoadEventController.js"></script>
<script src="AssignWinnerController.js"></script>

<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="css/sos.css">


<div ng-app="sosApp" ng-controller="sos" style="margin:20px">

  <!-- No Event yet -->
  <div ng-if="currentEvent == null" style="padding:20px">
    <div style="width:100%; text-align:center">
      <h1>SWCCG Tournament Assistant</h1>
    </div>

    <hr>

    <div class="row choiceContainer">

      <div style="text-align:center">
        <div>
          <button class="btn btn-primary btn-lg" ng-click="createEvent()">Create New Event</button>
          <button class="btn btn-primary btn-lg" ng-click="loadEvent()">Load Existing Event</button>
          <button class="btn btn-primary btn-lg" ng-click="loadEventFromFile()">Load File</button>
          <input style="display:none" type='file' id='fileinput'>
        </div>
      </div>

      <div style="position:absolute; right:0px; bottom:0px">
        <button class="btn btn-danger" ng-click="clearAllData()">DEBUG: Clear All Data</button>

      </div>

    </div>

  </div>


  <!-- Event Loaded! -->
  <div ng-if="currentEvent != null">

    <h1>{{currentEvent.name}}</h1>

    <hr>

    <div style="border-radius:5px; background-color:#EEEEEE; padding:20px">
      <div style="position:relative;">
        <h2>Players</h2>
        <div style="position:absolute; top:0; bottom:0; right:0; left:0;">
          <button class="btn btn-default" style="float:right;" data-ng-click="addPlayer()">Add Player</button>
        </div>
      </div>

      <div ng-if="currentEvent.players.length == 0" style="margin:50px">
        <h3 style="font-style:italic; color:gray">Click 'Add Player' to add players...</h3>
      </div>

      <div ng-if="currentEvent.players.length > 0">
        <!-- Headers -->
        <div ng-repeat="player in currentEvent.players | orderBy:['-vp', '-sos']" style="border:thin solid black; margin-top:5px; border-radius:4px;">
          <div style="margin:10px">
            <div class="row">

              <div class="col-xs-2">
                <div class="glyphicon glyphicon-user" style="font-size: 2.5em;"></div>
              </div>

              <div class="col-xs-4">
                <div>{{player.name}}</div>
                <div>SoS: {{player.sos}}</div>
                <div>Diff:
                  <span ng-if="player.diff >= 0" style="color:green"> ({{player.diff}}) </span>
                  <span ng-if="player.diff < 0" style="color:red"> ({{player.diff}}) </span>
                </div>
              </div>

              <div class="col-xs-4">
                <div>Victory Points: {{player.vp}}</div>
                <div>Record: {{player.wins}}-{{player.losses}}</div>
              </div>

              <div class="col-xs-2">
                <div style="color:red; position:absolute; right: 20px; top: 11px; font-size:1.5em;" ng-click="deletePlayer(player)" class="glyphicon glyphicon-remove"></div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>

    <hr>

    <div style="border-radius:5px; background-color:#EEEEEE; padding:20px">
      <div style="position:relative">
        <h2>Games</h2>
        <div style="position:absolute; top:0; bottom:0; right:0; left:0;">
          <button class="btn btn-default" style="float:right" data-ng-click="newRound()">New Round</button>
          <button class="btn btn-default" style="float:right; margin-right:20px" data-ng-click="createGame()">Create Game</button>
        </div>
      </div>
      <ul class="nav nav-tabs">
        <!--<li class="active"> <a href='#round1' data-toggle='tab'>Round 1</a> </li> -->
        <li ng-repeat='round in currentEvent.rounds' ng-class="{active: round.num == 1 && currentEvent.rounds.length == 1}">
            <a href='#round{{round.num}}' data-toggle='tab'>Round {{round.num}}</a>
        </li>
      </ul>

      <div class="tab-content">

          <!-- Games from this current round -->
          <div ng-repeat='round in currentEvent.rounds' id="round{{round.num}}" class="tab-pane fade in active">
            <div ng-if="currentEvent.games.length == 0" style="margin:50px">
              <h3 style="font-style:italic; color:gray">Click 'Create Game' to add a new game...</h3>

            </div>

            <div ng-if="currentEvent.games.length > 0">
              <!-- Headers -->
              <div style="margin-left:20px; margin-right:20px">
                <div class="row" >
                    <div class="col-xs-6">
                      <h5>Players</h5>
                    </div>
                    <div class="col-xs-6">
                      <h5>Winner</h5>
                    </div>
                </div>
              </div>

              <div ng-repeat="game in currentEvent.games" style="margin-left:20px; margin-right:20px" ng-show='game.round.num == round.num'>

                  <div>

                      <!-- Games Table -->
                      <div class="row" style="border:thin solid black;padding-bottom:5px;" ng-style="game.winner ? {'background-color': '#AAFFAA'} : {'background-color': '#FFAAAA'} ">

                          <div class="col-xs-6" style="margin-top:5px">
                              <div>Dark: {{game.playerDark.name}}</div>
                              <div>Light: {{game.playerLight.name}}</div>
                          </div>
                          <div class="col-xs-6" style="margin-top:5px">

                              <div ng-if="game.winner">
                                  <div>{{game.winner.name}}</div>
                                  <button ng-click="addResult(game)">Change</button>
                                  <div style="color:red; position:absolute; right: 20px; top: 11px; font-size:1.5em;" ng-click="deleteGame(game)" class="glyphicon glyphicon-remove"></div>
                              </div>

                              <div ng-if="!game.winner">
                                  <button ng-click="addResult(game)">Add Result</button>
                                  <div style="color:red; position:absolute; right: 20px; top: 11px; font-size:1.5em;" ng-click="deleteGame(game)" class="glyphicon glyphicon-remove"></div>
                              </div>

                          </div>
                      </div>
                  </div>

              </div>
          </div>
        </div>
      </div>
    </div>

    <hr>

    <div style="margin:20px">
      <button class="btn btn-success" style="float:right; margin-left:10px" data-ng-click="saveData()">Save Data</button>
      <button class="btn btn-success" style="float:right; margin-left:10px" data-ng-click="exportData()">Export Data</button>
      <div style="clear:both"></div>
    </div>
  </div>

</div>
</html>
